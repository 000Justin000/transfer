import openbabel
import pybel
import sys
import numpy as np
import math

#------------------------------------------------
jobname = str(sys.argv[1])
#------------------------------------------------
rb1 = [int(sys.argv[2]), int(sys.argv[3]), int(sys.argv[4]), int(sys.argv[5])]     # dihedral idx
rb2 = [int(sys.argv[6]), int(sys.argv[7]), int(sys.argv[8]), int(sys.argv[9])]     # dihedral idx
#------------------------------------------------

pybmol = pybel.readfile("pdb", jobname+".pdb").next()

#------------------------------------------------
# 1001
#------------------------------------------------
# rotlist = np.array([[  0,  0], [ 25, 75], [100,100], [180, 20], [212, 78], [248,105], [320, 80], [ 25,140], [205,155], [ 28,245], [175,215], [220,240], [305,255], [355,212], [245,290], [ 55, 285], [ 90, 270], [135, 235]])
#------------------------------------------------
# 1101
#------------------------------------------------
rotlist = np.array([[  0,  0], [ 35, 65], [ 40,130], [110, 90], [185,  0], [225, 65], [255, 92], [315, 65], [230,150], [ 30,230], [175,200], [220,230], [300,240], [355,195], [ 70,310], [250,310], [ 90,245], [ 80, 278]])
#------------------------------------------------
# 1111
#------------------------------------------------
# rotlist = np.array([[  0,  0], [ 35, 55], [ 90, 90], [130, 30], [210,  0], [235, 55], [260, 90], [310, 40], [ 50,150], [230,160], [  0,200], [ 30,220], [ 80,240], [230,220], [290,230], [ 70,320], [160,195], [200,200]])
#------------------------------------------------

#------------------------------------------------
rotlist = rotlist / 360.0 * 2*math.pi
#------------------------------------------------

#------------------------------------------------
for i in range(0,len(rotlist)):
    #--------------------------------------------
    rot_diangle1 = rotlist[i,0]
    rot_diangle2 = rotlist[i,1]
    #--------------------------------------------
    angle1 = pybmol.OBMol.GetTorsion(rb1[0],rb1[1],rb1[2],rb1[3])/360*(2*math.pi) + rot_diangle1
    angle2 = pybmol.OBMol.GetTorsion(rb2[0],rb2[1],rb2[2],rb2[3])/360*(2*math.pi) + rot_diangle2
    #--------------------------------------------
    molr = pybmol.clone
    molr.OBMol.SetTorsion(rb1[0],rb1[1],rb1[2],rb1[3], angle1)
    molr.OBMol.SetTorsion(rb2[0],rb2[1],rb2[2],rb2[3], angle2)
    #--------------------------------------------
    molr.write("xyz", jobname + "_" + "{:02d}".format(i) + ".xyz")
    #--------------------------------------------
